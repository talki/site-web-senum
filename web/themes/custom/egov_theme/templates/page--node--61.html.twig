{# Template de page pour les video podcast #}



{{ include(active_theme_path() ~ '/templates/partials/header.html.twig') }}

<!-- Hero Section -->
<section class="podcast-hero">
    <div class="hero-content">
        <div class="hero-icon"></div>
        <h1>Vid√©os Podcast eGov</h1>
        <p>D√©couvrez nos √©missions exclusives sur la transformation digitale, l'innovation technologique et l'avenir de l'e-gouvernement au S√©n√©gal</p>
    </div>
</section>

<!-- Stats Bar -->
<section class="stats-bar">
    <div class="stats-container">
        <div class="stat-item">
            <span class="stat-number">{{ videos_podcast|length }}+</span>
            <span class="stat-label">√âpisodes Publi√©s</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">250K+</span>
            <span class="stat-label">Vues Totales</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">15K+</span>
            <span class="stat-label">Abonn√©s</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">12</span>
            <span class="stat-label">Playlists Th√©matiques</span>
        </div>
    </div>
</section>

<!-- Filter Section -->
<section class="filter-section">
    <div class="filter-container">
        <span class="filter-label">Cat√©gories :</span>
        <button class="filter-btn active" data-filter="all">Tous</button>
        <button class="filter-btn" data-filter="interview">Interviews</button>
        <button class="filter-btn" data-filter="tutorial">Tutoriels</button>
        <button class="filter-btn" data-filter="conference">Conf√©rences</button>
        <button class="filter-btn" data-filter="actualite">Actualit√©s</button>
    </div>
</section>

<!-- Main Content -->
<main class="podcast-main">
    <div class="podcast-container">

        <!-- Featured Video -->
   {% if videos_podcast|first %}
    {% set featured = videos_podcast|first %}
    {% if featured.field_url_video.value %}
        {% set video_id = featured.field_url_video.value|split('live/')[1]|split('?')[0] %}
    {% endif %}
    <div class="featured-video">
        <div class="featured-thumbnail" {% if video_id %}style="background-image: url('https://img.youtube.com/vi/{{ video_id }}/maxresdefault.jpg'); background-size: cover; position: relative;"{% endif %}>
            <span class="video-badge">‚ú® NOUVEAU</span>
            <div class="play-button" {% if video_id %}onclick="playVideoInline(this, '{{ video_id }}')" style="cursor: pointer;"{% endif %}>‚ñ∂</div>
            <span class="video-duration">{{ featured.field_duree.value }}</span>
        </div>
                <div class="featured-details">
                    <span class="featured-category">
                        {% if featured.field_categorie.value == 'interview' %}Interview
                        {% elseif featured.field_categorie.value == 'tutorial' %}Tutoriel
                        {% elseif featured.field_categorie.value == 'conference' %}Conf√©rence
                        {% else %}Actualit√©
                        {% endif %}
                    </span>
                    <h2>{{ featured.title.value }}</h2>
                    <div class="featured-meta">
                        <span>üìÖ {{ featured.created.value|format_date('custom', 'd F Y', null, 'fr') }}</span>
                        <span>üëÅÔ∏è {{ featured.field_vues.value|number_format(0, ',', '.') }} vues</span>
                        <span>üí¨ {{ random(50, 200) }} commentaires</span>
                    </div>
                    <p class="featured-description">
                        {{ featured.field_extrait.value }}
                    </p>
                    <div class="featured-actions">
                        <a href="{{ path('entity.node.canonical', {'node': featured.id}) }}" class="action-btn btn-primary">
                            <span>‚ñ∂</span>
                            <span>Regarder maintenant</span>
                        </a>
                        <button class="action-btn btn-secondary">
                            <span>üìã</span>
                            <span>Playlist</span>
                        </button>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Recent Videos Section -->
        <div class="section-header">
            <h2 class="section-title">üé¨ Derniers √âpisodes</h2>
            <a href="#" class="view-all-link">Voir tout ‚Üí</a>
        </div>

        <div class="videos-grid">
            {% for video in videos_podcast %}
                {% if loop.index > 1 %}

                    <div class="video-card" data-category="{{ video.field_categorie.value }}">
                        {% if video.field_url_video.value %}
                            {% set video_id = video.field_url_video.value|split('live/')[1]|split('?')[0] %}
                        {% endif %}

                        <!-- Vignette cliquable pour ouvrir le player -->
                 <!-- Vignette cliquable pour jouer la vid√©o inline -->
<div class="video-thumbnail gradient-{{ random(['purple', 'pink', 'cyan', 'orange', 'blue', 'green', 'indigo', 'red']) }}" 
     {% if video_id %}style="background-image: url('https://img.youtube.com/vi/{{ video_id }}/maxresdefault.jpg'); background-size: cover; position: relative;"{% endif %}>
    {% if loop.index == 2 %}
    <span class="video-new-badge">NOUVEAU</span>
    {% endif %}
    <div class="thumbnail-play" {% if video_id %}onclick="playVideoInline(this, '{{ video_id }}')" style="cursor: pointer;"{% endif %}>‚ñ∂</div>
    <span class="video-time">{{ video.field_duree.value }}</span>
</div>

                        <div class="video-content">
                            <span class="video-category">
                                {% if video.field_categorie.value == 'interview' %}Interview
                                {% elseif video.field_categorie.value == 'tutorial' %}Tutoriel
                                {% elseif video.field_categorie.value == 'conference' %}Conf√©rence
                                {% else %}Actualit√©
                                {% endif %}
                            </span>
                            <!-- Titre cliquable vers la page de d√©tail -->
                            <h3><a href="{{ path('entity.node.canonical', {'node': video.id}) }}">{{ video.title.value }}</a></h3>
                            <p class="video-description">
                                {{ video.field_extrait.value }}
                            </p>
                            <div class="video-stats">
                                <span class="video-stat">
                                    <span>üìÖ</span>
                                    <span>{{ video.created.value|format_date('custom', 'd M Y') }}</span>
                                </span>
                                <span class="video-stat">
                                    <span>üëÅÔ∏è</span>
                                    <span>{{ (video.field_vues.value / 1000)|number_format(1, '.', '') }}K vues</span>
                                </span>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <!-- Playlists Section -->
        <div class="playlists-section">
            <div class="section-header">
                <h2 class="section-title">üìö Playlists Th√©matiques</h2>
                <a href="#" class="view-all-link">Voir toutes ‚Üí</a>
            </div>

            <div class="playlists-grid">

                <div class="playlist-card">
                    <div class="playlist-cover gradient-purple">
                        <span class="playlist-count">12 vid√©os</span>
                    </div>
                    <div class="playlist-info">
                        <h3>Formation D√©veloppeurs</h3>
                        <p class="playlist-description">
                            Tutoriels complets pour ma√Ætriser l'int√©gration des API eGov
                        </p>
                        <div class="playlist-meta">
                            <span>6h 30min</span>
                            <span>45K vues</span>
                        </div>
                    </div>
                </div>

                <div class="playlist-card">
                    <div class="playlist-cover gradient-pink">
                        <span class="playlist-count">8 vid√©os</span>
                    </div>
                    <div class="playlist-info">
                        <h3>Interviews Experts</h3>
                        <p class="playlist-description">
                            Rencontres avec les acteurs cl√©s de la transformation digitale
                        </p>
                        <div class="playlist-meta">
                            <span>4h 15min</span>
                            <span>38K vues</span>
                        </div>
                    </div>
                </div>

                <div class="playlist-card">
                    <div class="playlist-cover gradient-cyan">
                        <span class="playlist-count">15 vid√©os</span>
                    </div>
                    <div class="playlist-info">
                        <h3>S√©curit√© & Conformit√©</h3>
                        <p class="playlist-description">
                            Tout sur la s√©curit√© des donn√©es et la conformit√© r√©glementaire
                        </p>
                        <div class="playlist-meta">
                            <span>7h 45min</span>
                            <span>52K vues</span>
                        </div>
                    </div>
                </div>

                <div class="playlist-card">
                    <div class="playlist-cover gradient-orange">
                        <span class="playlist-count">10 vid√©os</span>
                    </div>
                    <div class="playlist-info">
                        <h3>Innovation & Startups</h3>
                        <p class="playlist-description">
                            D√©couvrez les solutions innovantes de l'√©cosyst√®me tech s√©n√©galais
                        </p>
                        <div class="playlist-meta">
                            <span>5h 20min</span>
                            <span>31K vues</span>
                        </div>
                    </div>
                </div>

                <div class="playlist-card">
                    <div class="playlist-cover gradient-blue">
                        <span class="playlist-count">9 vid√©os</span>
                    </div>
                    <div class="playlist-info">
                        <h3>E-Sant√© & Digital Health</h3>
                        <p class="playlist-description">
                            Digitalisation du secteur de la sant√© au S√©n√©gal
                        </p>
                        <div class="playlist-meta">
                            <span>4h 50min</span>
                            <span>42K vues</span>
                        </div>
                    </div>
                </div>

                <div class="playlist-card">
                    <div class="playlist-cover gradient-green">
                        <span class="playlist-count">14 vid√©os</span>
                    </div>
                    <div class="playlist-info">
                        <h3>Smart Cities & IoT</h3>
                        <p class="playlist-description">
                            Villes intelligentes et Internet des Objets pour l'administration
                        </p>
                        <div class="playlist-meta">
                            <span>6h 10min</span>
                            <span>28K vues</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Newsletter Section -->
        <div class="newsletter-section">
            <div class="newsletter-icon">üìß</div>
            <h2>Ne Manquez Aucun √âpisode</h2>
            <p>
                Inscrivez-vous √† notre newsletter pour recevoir les notifications des nouveaux 
                √©pisodes, les √©v√©nements √† venir et les contenus exclusifs.
            </p>
            <form class="newsletter-form">
                <input type="email" class="newsletter-input" placeholder="Votre adresse email" required>
                <button type="submit" class="newsletter-btn">S'abonner</button>
            </form>
        </div>

    </div>
</main>
    {{ include(active_theme_path() ~ '/templates/partials/footer.html.twig') }}


    <!-- Modal pour le player vid√©o -->
    <div id="videoModal" class="video-modal" onclick="closeVideoModal()">
        <div class="video-modal-content" onclick="event.stopPropagation()">
            <span class="video-modal-close" onclick="closeVideoModal()">&times;</span>
            <div id="videoPlayerContainer"></div>
        </div>
    </div>
    
    
<script>
(function() {
    'use strict';

    console.log('Vid√©os Podcast - Filtres initialis√©s');

    // ========== √âL√âMENTS DOM ==========
    const filterButtons = document.querySelectorAll('.filter-btn');
    const videoCards = document.querySelectorAll('.video-card');

    console.log('Boutons de filtre trouv√©s:', filterButtons.length);
    console.log('Cartes vid√©o trouv√©es:', videoCards.length);

    // ========== FONCTION DE FILTRAGE ==========
    function applyFilter(filterValue) {
        console.log('Filtre appliqu√©:', filterValue);
        
        let visibleCount = 0;

        videoCards.forEach(card => {
            const category = card.getAttribute('data-category');
            
            // R√©initialiser les styles
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            if (filterValue === 'all') {
                // Afficher toutes les vid√©os
                card.style.display = 'block';
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 50 + (visibleCount * 50)); // Animation en cascade
                visibleCount++;
            } else {
                // Filtrer par cat√©gorie
                if (category === filterValue) {
                    card.style.display = 'block';
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, 50 + (visibleCount * 50));
                    visibleCount++;
                } else {
                    setTimeout(() => {
                        card.style.display = 'none';
                    }, 300);
                }
            }
        });

        // Afficher message si aucun r√©sultat
        checkForNoResults(visibleCount);
        
        console.log('Vid√©os visibles:', visibleCount);
    }

    // ========== MESSAGE AUCUN R√âSULTAT ==========
    function checkForNoResults(visibleCount) {
        // Retirer ancien message
        const existingMessage = document.querySelector('.no-results-message');
        if (existingMessage) {
            existingMessage.remove();
        }

        // Afficher message si aucun r√©sultat
        if (visibleCount === 0) {
            const videosGrid = document.querySelector('.videos-grid');
            if (videosGrid) {
                const message = document.createElement('div');
                message.className = 'no-results-message';
                message.style.cssText = 'grid-column: 1 / -1; text-align: center; padding: 4rem 2rem; color: #666;';
                message.innerHTML = `
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üé¨</div>
                    <h3 style="margin-bottom: 0.5rem;">Aucune vid√©o dans cette cat√©gorie</h3>
                    <p>Essayez de s√©lectionner une autre cat√©gorie</p>
                `;
                videosGrid.appendChild(message);
            }
        }
    }

    // ========== √âV√âNEMENTS BOUTONS FILTRES ==========
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            console.log('Bouton cliqu√©:', this.getAttribute('data-filter'));
            
            // Retirer la classe active de tous les boutons
            filterButtons.forEach(btn => btn.classList.remove('active'));
            
            // Ajouter la classe active au bouton cliqu√©
            this.classList.add('active');
            
            // Appliquer le filtre
            const filterValue = this.getAttribute('data-filter');
            applyFilter(filterValue);
        });
    });

    // ========== ANIMATIONS AU SCROLL ==========
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observer les cartes vid√©o
    videoCards.forEach(card => {
        card.style.transition = 'all 0.6s ease';
        observer.observe(card);
    });

    // ========== NEWSLETTER FORM ==========
    const newsletterForm = document.querySelector('.newsletter-form');
    if (newsletterForm) {
        newsletterForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const emailInput = this.querySelector('input[type="email"]');
            const email = emailInput.value;
            
            // Animation de succ√®s
            const btn = this.querySelector('.newsletter-btn');
            const originalText = btn.textContent;
            btn.textContent = '‚úì Inscrit !';
            btn.style.background = '#00a651';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
                emailInput.value = '';
            }, 3000);
            
            console.log('Inscription newsletter:', email);
        });
    }

    // ========== INITIALISATION ==========
    console.log('‚úÖ Filtres vid√©os initialis√©s avec succ√®s');

})();

// ========== FONCTION POUR JOUER VID√âO INLINE ==========
function playVideoInline(element, videoId) {
    console.log('Lecture vid√©o:', videoId);
    
    // Trouver le conteneur parent
    const container = element.parentElement;
    
    // Cr√©er l'iframe YouTube
    const iframe = document.createElement('iframe');
    iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
    iframe.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 12px;';
    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    iframe.allowFullscreen = true;
    
    // Remplacer le contenu par l'iframe
    container.innerHTML = '';
    container.appendChild(iframe);
}

// ========== MODAL VIDEO (si vous voulez l'utiliser) ==========
function openVideoModal(videoId) {
    const modal = document.getElementById('videoModal');
    const playerContainer = document.getElementById('videoPlayerContainer');
    
    if (modal && playerContainer) {
        // Cr√©er l'iframe
        const iframe = document.createElement('iframe');
        iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        iframe.style.cssText = 'width: 100%; height: 100%; min-height: 500px; border: none;';
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
        iframe.allowFullscreen = true;
        
        playerContainer.innerHTML = '';
        playerContainer.appendChild(iframe);
        
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
}

function closeVideoModal() {
    const modal = document.getElementById('videoModal');
    const playerContainer = document.getElementById('videoPlayerContainer');
    
    if (modal && playerContainer) {
        modal.style.display = 'none';
        playerContainer.innerHTML = '';
        document.body.style.overflow = '';
    }
}

// Fermer la modal avec la touche √âchap
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeVideoModal();
    }
});
</script>

<style>
/* Transitions pour les cartes vid√©o */
.video-card {
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 1;
    transform: translateY(0);
}

/* Animation pour les filtres */
.filter-btn {
    transition: all 0.3s ease;
}

.filter-btn.active {
    background: #00a651;
    color: white;
    transform: scale(1.05);
}

.filter-btn:hover:not(.active) {
    background: #f0f0f0;
    transform: translateY(-2px);
}

/* Message aucun r√©sultat */
.no-results-message {
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Modal vid√©o */
.video-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
}

.video-modal-content {
    position: relative;
    width: 90%;
    max-width: 1200px;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
}

.video-modal-close {
    position: absolute;
    top: -40px;
    right: 0;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 10001;
    transition: transform 0.3s ease;
}

.video-modal-close:hover {
    transform: scale(1.2);
}

/* Style pour le bouton newsletter apr√®s soumission */
.newsletter-btn {
    transition: all 0.3s ease;
}

/* Responsive pour les miniatures vid√©o */
.video-thumbnail,
.featured-thumbnail {
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.video-thumbnail:hover,
.featured-thumbnail:hover {
    transform: scale(1.02);
}

.thumbnail-play,
.play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #00a651;
    cursor: pointer;
    transition: all 0.3s ease;
}

.thumbnail-play:hover,
.play-button:hover {
    background: white;
    transform: translate(-50%, -50%) scale(1.1);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}
</style>