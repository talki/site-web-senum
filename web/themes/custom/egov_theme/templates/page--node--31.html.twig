

{# ========== HEADER ========== #}
{{ include(active_theme_path() ~ '/templates/partials/header.html.twig') }}


<!-- Hero Section -->
<section class="news-hero">
    <div class="news-hero-content">
        <h1>Publications Officielles</h1>
        <p>Consultez nos rapports, √©tudes et documents officiels de la plateforme nationale d'interop√©rabilit√©</p>
    </div>
</section>

<!-- Filter Section -->
<section class="filter-section">
    <div class="filter-container">
        <span class="filter-label">Filtrer par :</span>
        <button class="filter-btn active" data-filter="all">Tout voir</button>
        <button class="filter-btn" data-filter="urgent">Urgent</button>
        <button class="filter-btn" data-filter="nouveau">Nouveau</button>
        <button class="filter-btn" data-filter="info">Info</button>
        <button class="filter-btn" data-filter="annonce">Annonce</button>
    </div>
</section>

<!-- Main Content -->
<main class="news-main">
    <div class="news-container">

        <!-- Featured Article - DYNAMIQUE -->
        {% if publications_recentes and publications_recentes|length > 0 %}
            {% set featured = publications_recentes|first %}
            {% set categorie_featured = featured.field_categorie.value %}

            <article class="featured-article">
                <div class="featured-image">
                    {% if categorie_featured == 'urgent' %}üöÄ
                    {% elseif categorie_featured == 'nouveau' %}
                        <img src="/themes/custom/egov_theme/icon/graph.png" alt="" style="width: 78px; height: 58px;" class="help-icon">

                    {% elseif categorie_featured == 'info' %}
                        <img src="/themes/custom/egov_theme/icon/publication.png" alt="" style="width: 78px; height: 58px;" class="help-icon">

                    {% elseif categorie_featured == 'annonce' %}üéâ
                    {% else %}üöÄ
                    {% endif %}
                </div>
                <div class="featured-content">
                    <span class="featured-badge">√Ä LA UNE</span>
                    <h2>{{ featured.title.value }}</h2>
                    <div class="featured-meta">
                        <span>üìÖ {{ featured.created.value|date('d M Y') }}</span>
                        {% if featured.field_temps_lecture.value %}
                            <span>‚è±Ô∏è {{ featured.field_temps_lecture.value }} min de lecture</span>
                        {% endif %}
                    </div>
                    <p class="featured-excerpt">
                        {{ featured.field_extrait.value }}
                    </p>
                    <a href="{{ path('entity.node.canonical', {'node': featured.nid.value}) }}" class="featured-link">
                        <span>Lire l'article complet</span>
                        <span>‚Üí</span>
                    </a>
                </div>
            </article>
        {% else %}
            {# FALLBACK Featured si pas d'actualit√©s #}
            <article class="featured-article">
                <div class="featured-image">
                    üöÄ
                </div>
                <div class="featured-content">
                    <span class="featured-badge">√Ä LA UNE</span>
                    <h2>Lancement de l'API Universelle v3.0</h2>
                    <div class="featured-meta">
                        <span>üìÖ 15 Novembre 2025 </span>
                        <span>‚è±Ô∏è 8 min de lecture</span>
                    </div>
                    <p class="featured-excerpt">
                        D√©couvrez la nouvelle version majeure de notre API avec des fonctionnalit√©s 
                        r√©volutionnaires : authentification biom√©trique, traitement temps r√©el am√©lior√©, 
                        et int√©gration IA pour une meilleure pr√©diction des services citoyens.
                    </p>
                    <a href="#" class="featured-link">
                        <span>Lire l'article complet</span>
                        <span>‚Üí</span>
                    </a>
                </div>
            </article>
        {% endif %}

        <!-- Articles Grid - DYNAMIQUE -->
        <div class="articles-grid">
            {% if publications_recentes and publications_recentes|length > 1 %}
                {# CONTENU DYNAMIQUE DEPUIS DRUPAL #}
                {% for actualite in publications_recentes %}
                    {% if loop.index > 1 %} {# Skip le premier qui est featured #}
                        {% set categorie = actualite.field_categorie.value %}

                        {# Mapping des ic√¥nes #}
                        {% if categorie == 'urgent' %}
                            {% set icon = '‚ö†Ô∏è' %}
                            {% set badge_label = 'URGENT' %}
                        {% elseif categorie == 'nouveau' %}
                            {% set icon = 'üéì' %}
                            {% set badge_label = 'NOUVEAU' %}
                        {% elseif categorie == 'info' %}
                            {% set icon = 'üìù' %}
                            {% set badge_label = 'INFO' %}
                        {% elseif categorie == 'annonce' %}
                            {% set icon = 'ü§ù' %}
                            {% set badge_label = 'ANNONCE' %}
                        {% else %}
                            {% set icon = 'üì∞' %}
                            {% set badge_label = 'INFO' %}
                        {% endif %}
                        {% set icon = '' %}

                        <article class="article-card" data-category="{{ categorie }}">
                            <div class="article-image">
                                <span class="article-badge badge-{{ categorie }}">{{ badge_label }}</span>
                                {{ icon }}
                            </div>
                            <div class="article-content">
                                <div class="article-meta">
                                    <span>üìÖ {{ actualite.created.value|date('d M Y') }}</span>
                                    {% if actualite.field_temps_lecture.value %}
                                        <span>‚è±Ô∏è {{ actualite.field_temps_lecture.value }} min</span>
                                    {% endif %}
                                </div>
                                <h3>{{ actualite.title.value }}</h3>
                                <p class="article-excerpt">
                                    {{ actualite.field_extrait.value }}
                                </p>
                                <a href="{{ path('entity.node.canonical', {'node': actualite.nid.value}) }}" class="article-link">
                                    <span>Lire plus</span>
                                    <span>‚Üí</span>
                                </a>
                            </div>
                        </article>
                    {% endif %}
                {% endfor %}

            {% else %}
                {# include '@egov_theme/actualites-fallback.html.twig'  #}


            {% endif %}
        </div>


        <!-- Pagination -->
        {% if pagination is defined and pagination.total_pages >= 1 %}
            <div class="pagination">
                {# Bouton Pr√©c√©dent #}
                {% if pagination.current_page > 0 %}
                    <a href="?page={{ pagination.current_page - 1 }}" class="pagination-btn">‚Äπ</a>
                {% else %}
                    <span class="pagination-btn disabled">‚Äπ</span>
                {% endif %}

                {# Num√©ros de pages #}
                {% for i in 0..(pagination.total_pages - 1) %}
                    {% if i == pagination.current_page %}
                        <span class="pagination-btn active">{{ i + 1 }}</span>
                    {% else %}
                        <a href="?page={{ i }}" class="pagination-btn">{{ i + 1 }}</a>
                    {% endif %}
                {% endfor %}

                {# Bouton Suivant #}
                {% if pagination.current_page < pagination.total_pages - 1 %}
                    <a href="?page={{ pagination.current_page + 1 }}" class="pagination-btn">‚Ä∫</a>
                {% else %}
                    <span class="pagination-btn disabled">‚Ä∫</span>
                {% endif %}
            </div>

            <div class="pagination-info">
                Page {{ pagination.current_page + 1 }} sur {{ pagination.total_pages }} 
                ({{ pagination.total_items }} publications)
            </div>
        {% endif %}

    </div>
</main>
<script>
(function() {
    'use strict';
    
    console.log('üîç Script filtre charg√©');
    
    const filterButtons = document.querySelectorAll('.filter-btn');
    const articles = document.querySelectorAll('.article-card');
    
    console.log('Boutons filtre trouv√©s:', filterButtons.length);
    console.log('Articles trouv√©s:', articles.length);
    
    if (filterButtons.length === 0) {
        console.error('‚ùå Aucun bouton filtre trouv√© !');
        return;
    }
    
    if (articles.length === 0) {
        console.error('‚ùå Aucun article trouv√© !');
        return;
    }
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            console.log('Click sur filtre:', this.getAttribute('data-filter'));
            
            // Retirer active de tous les boutons
            filterButtons.forEach(btn => btn.classList.remove('active'));
            
            // Ajouter active au bouton cliqu√©
            this.classList.add('active');
            
            const filter = this.getAttribute('data-filter');
            
            articles.forEach(article => {
                const category = article.getAttribute('data-category');
                console.log('Article category:', category);
                
                if (filter === 'all' || category === filter) {
                    article.style.display = 'flex';
                    article.style.opacity = '1';
                } else {
                    article.style.display = 'none';
                    article.style.opacity = '0';
                }
            });
        });
    });
    
    console.log('‚úÖ Filtre initialis√©');
})();
</script>
<!-- Footer -->
{{ include(active_theme_path() ~ '/templates/partials/footer.html.twig') }}



{{ attach_library('egov_theme/publications-page') }}
